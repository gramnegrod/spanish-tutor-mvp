<!DOCTYPE html>
<html>
<head>
    <title>Realtime API Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; }
        #log { border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: auto; }
        .user { color: blue; }
        .assistant { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>OpenAI Realtime API Test</h1>
    <button onclick="testConnection()">Test Connection</button>
    <div id="log"></div>

    <script>
        function log(message, type = '') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        async function testConnection() {
            const apiKey = 'YOUR_OPENAI_API_KEY';
            
            log('Testing connection to OpenAI Realtime API...');
            
            try {
                // Test 1: Check if we can reach OpenAI API
                log('Test 1: Checking OpenAI API access...');
                const testResponse = await fetch('https://api.openai.com/v1/models', {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`
                    }
                });
                
                if (!testResponse.ok) {
                    throw new Error(`API test failed: ${testResponse.status} ${testResponse.statusText}`);
                }
                
                log('✓ API key is valid', 'assistant');
                
                // Test 2: Try WebSocket connection
                log('Test 2: Attempting WebSocket connection...');
                
                const ws = new WebSocket(
                    'wss://api.openai.com/v1/realtime?model=gpt-4o-realtime-preview-2024-10-01',
                    {
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'OpenAI-Beta': 'realtime=v1'
                        }
                    }
                );
                
                ws.onopen = () => {
                    log('✓ WebSocket connected!', 'assistant');
                    
                    // Send a test message
                    ws.send(JSON.stringify({
                        type: 'session.update',
                        session: {
                            modalities: ['text'],
                            instructions: 'Say hello in Spanish'
                        }
                    }));
                };
                
                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    log(`Received: ${data.type}`, 'assistant');
                    
                    if (data.type === 'error') {
                        log(`Error: ${JSON.stringify(data.error)}`, 'error');
                    }
                };
                
                ws.onerror = (error) => {
                    log(`WebSocket error: ${error}`, 'error');
                };
                
                ws.onclose = (event) => {
                    log(`WebSocket closed: ${event.code} ${event.reason}`, 'error');
                };
                
            } catch (error) {
                log(`Error: ${error.message}`, 'error');
                
                // Try alternative connection method
                log('Trying alternative connection method...');
                
                try {
                    // Test with simple WebSocket
                    const ws2 = new WebSocket('wss://api.openai.com/v1/realtime?model=gpt-4o-realtime-preview-2024-10-01');
                    
                    ws2.onopen = () => {
                        log('WebSocket opened, sending auth...', 'assistant');
                        // Try sending auth after connection
                        ws2.send(JSON.stringify({
                            type: 'session.update',
                            session: {
                                modalities: ['text'],
                                instructions: 'You are a helpful assistant'
                            },
                            headers: {
                                'Authorization': `Bearer ${apiKey}`
                            }
                        }));
                    };
                    
                    ws2.onmessage = (event) => {
                        log(`Alternative method response: ${event.data}`, 'assistant');
                    };
                    
                    ws2.onerror = (error) => {
                        log(`Alternative method error: ${error}`, 'error');
                    };
                    
                } catch (error2) {
                    log(`Alternative method failed: ${error2.message}`, 'error');
                }
            }
        }
    </script>
</body>
</html>