<!DOCTYPE html>
<html>
<head>
  <title>Quick NPM Module Test</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: 50px auto; padding: 20px; }
    button { font-size: 18px; padding: 10px 20px; margin: 10px; cursor: pointer; }
    #status { padding: 10px; margin: 10px 0; border-radius: 5px; }
    .connected { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    #log { background: #f5f5f5; padding: 10px; height: 200px; overflow-y: auto; }
  </style>
</head>
<body>
  <h1>üé§ Quick Sanity Check</h1>
  
  <div id="status">Not connected</div>
  
  <button onclick="connect()">Connect</button>
  <button onclick="speak()">Say Hello</button>
  <button onclick="disconnect()">Disconnect</button>
  
  <h3>Instructions:</h3>
  <ol>
    <li>Start your API server: <code>cd /Users/rodneyfranklin/Development/personal/VoiceNPMmoduletest && npm run server</code></li>
    <li>Open this file in your browser</li>
    <li>Click "Connect" and allow microphone</li>
    <li>Click "Say Hello" or just speak</li>
    <li>You should hear AI response!</li>
  </ol>
  
  <h3>Event Log:</h3>
  <div id="log"></div>

  <script type="module">
    // Import from the built module
    import { OpenAIRealtimeService } from './dist/index.esm.js';
    
    let service;
    
    window.connect = async function() {
      try {
        log('Connecting...');
        
        service = new OpenAIRealtimeService({
          tokenEndpoint: 'http://localhost:3001/api/session',
          debug: true
        });
        
        // Listen for audio - this is the key!
        service.on('audioTrackReceived', (track) => {
          log('‚úÖ Audio track received! Playing...');
          const audio = new Audio();
          audio.srcObject = new MediaStream([track]);
          audio.play();
        });
        
        service.on('textReceived', (text) => {
          log('AI: ' + text);
        });
        
        service.on('error', (error) => {
          log('‚ùå Error: ' + error.message);
          document.getElementById('status').className = 'error';
          document.getElementById('status').textContent = 'Error: ' + error.message;
        });
        
        await service.connect();
        
        log('‚úÖ Connected!');
        document.getElementById('status').className = 'connected';
        document.getElementById('status').textContent = 'Connected - Speak now!';
        
      } catch (error) {
        log('‚ùå Failed: ' + error.message);
      }
    }
    
    window.speak = function() {
      if (service && service.isConnected()) {
        service.sendText('Hello! How are you today?');
        log('You: Hello! How are you today?');
      } else {
        log('Not connected!');
      }
    }
    
    window.disconnect = function() {
      if (service) {
        service.disconnect();
        log('Disconnected');
        document.getElementById('status').className = '';
        document.getElementById('status').textContent = 'Disconnected';
      }
    }
    
    function log(message) {
      const logDiv = document.getElementById('log');
      logDiv.innerHTML += new Date().toLocaleTimeString() + ' - ' + message + '<br>';
      logDiv.scrollTop = logDiv.scrollHeight;
    }
    
    // Log to show module loaded
    log('Module loaded, ready to connect!');
  </script>
</body>
</html>